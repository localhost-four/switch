const joltite=function(e){"use strict";function t(e,t,s,n){return new(s||(s=Promise))(function(i,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,u)}a((n=n.apply(e,t||[])).next())})}const s="https://api.gamejolt.com/api/game/v1_2",n={users:{auth:(e,t)=>`/users/auth/?username=${e}&user_token=${t}`,fetch:e=>`/users/?user_id=${e.join()}`},sessions:{open:(e,t)=>`/sessions/open/?username=${e}&user_token=${t}`,ping:(e,t,s)=>`/sessions/ping/?username=${e}&user_token=${t}&status=${s}`,close:(e,t)=>`/sessions/close/?username=${e}&user_token=${t}`},scores:{add:(e,t)=>`/scores/add/?score=${e}&sort=${t}`,fetch:()=>"/scores/?",tables:()=>"/scores/tables/?",rank:e=>`/scores/get-rank/?sort=${e}`},trophies:{add:(e,t,s)=>`/trophies/add-achieved/?username=${e}&user_token=${t}&trophy_id=${s}`,remove:(e,t,s)=>`/trophies/remove-achieved/?username=${e}&user_token=${t}&trophy_id=${s}`,fetch:(e,t)=>`/trophies/?username=${e}&user_token=${t}`},dataStorage:{fetch:e=>`/data-store/?key=${e}`,set:(e,t)=>`/data-store/set/?key=${e}&data=${t}`,update:(e,t,s)=>`/data-store/update/?key=${e}&operation=${t}&value=${s}`,remove:e=>`/data-store/remove/?key=${e}`,getKeys:()=>"/data-store/get-keys/?"},friends:{fetch:(e,t)=>`/friends/?username=${e}&user_token=${t}`},time:{fetch:()=>"/time/?"}},i="undefined"!=typeof window;var r,o;function u(e){return t(this,void 0,void 0,function*(){return i&&window.crypto.subtle?function(e){return t(this,void 0,void 0,function*(){const t=new TextEncoder,s=yield crypto.subtle.digest("SHA-1",t.encode(e));return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")})}(e):function(e){const t=require("crypto").createHash("sha1");return t.update(e),t.digest("hex")}(e)})}!function(e){e.GET="GET",e.POST="POST"}(r||(r={})),function(e){e.Json="json",e.Dump="dump"}(o||(o={}));const a=i?window.fetch:require("node-fetch");class d{constructor(e,t,s={}){this.client=e,this.method=s.method||r.GET,this.path=t,this.body=s.body,this.format=s.format||o.Json}make(){return t(this,void 0,void 0,function*(){let e=`${this.path}&game_id=${this.client.gameId}`;this.format!==o.Json&&(e+=`&format=${this.format}`);const t=yield this.signature(e);return a(`${e}&signature=${t}`,{method:this.method,body:this.body})})}signature(e){return u(e+this.client.privateKey)}}class h{constructor(e){this.client=e}request(e,n={}){return t(this,void 0,void 0,function*(){const t=s+encodeURI(e),i=new d(this.client,t,n),r=yield i.make();let u;if(i.format===o.Json){const e=(yield r.json()).response;e.success="true"===e.success,u=e}else u=r.text();return u})}}class c extends h{auth(e){return t(this,void 0,void 0,function*(){const{username:t,token:s}=e;return yield this.request(n.users.auth(t,s))})}fetch(e){return t(this,void 0,void 0,function*(){const t="number"==typeof e?[e]:e;return yield this.request(n.users.fetch(t))})}}class l extends h{constructor(){super(...arguments),this.status="active"}set isActive(e){this.status=e?"active":"idle"}open(){return t(this,void 0,void 0,function*(){const{username:e,token:t}=this.client.authCredentials,s=yield this.request(n.sessions.open(e,t));if(s.success){setInterval(()=>this.ping(),3e4)}return s})}ping(){return t(this,void 0,void 0,function*(){const{username:e,token:t}=this.client.authCredentials;return yield this.request(n.sessions.ping(e,t,this.status))})}close(){return t(this,void 0,void 0,function*(){const{username:e,token:t}=this.client.authCredentials;return yield this.request(n.sessions.close(e,t))})}}class v extends h{add(e,s,i={}){return t(this,void 0,void 0,function*(){let t=n.scores.add(e,s);return t+=this.guestOrUser(i.guest),i.extraData&&(t+=`&extra_data=${i.extraData}`),i.tableId&&(t+=`&table_id=${i.tableId}`),yield this.request(t)})}fetch(e={}){return t(this,void 0,void 0,function*(){const{username:t,token:s}=this.client.authCredentials;let i=n.scores.fetch();return e.userOnly?i+=`&username=${t}&user_token=${s}`:e.guest&&(i+=`&guest=${e.guest}`),e.betterThan?i+=`&better_than=${e.betterThan}`:e.worseThan&&(i+=`&worse_than=${e.worseThan}`),e.tableId&&(i+=`&table_id=${e.tableId}`),e.limit&&(i+=`&limit=${e.limit}`),yield this.request(i)})}getRank(e,s){return t(this,void 0,void 0,function*(){let t=n.scores.rank(e);return s&&(t+=`&table_id=${s}`),yield this.request(t)})}tables(){return t(this,void 0,void 0,function*(){return yield this.request(n.scores.tables())})}guestOrUser(e){const{username:t,token:s}=this.client.authCredentials;return e?`&guest=${e}`:`&username=${t}&user_token=${s}`}}class f extends h{constructor(){super(...arguments),this.fetchedTrophies=[]}fetch(e){return t(this,void 0,void 0,function*(){const{username:t,token:s}=this.client.authCredentials;let i=n.trophies.fetch(t,s);e&&(i+=`&achieved=${e}`);const r=yield this.request(i);return r&&r.trophies&&(this.fetchedTrophies=r.trophies),r})}fetchById(e){return t(this,void 0,void 0,function*(){const{username:t,token:s}=this.client.authCredentials,i="number"==typeof e?[e]:e;return yield this.request(`${n.trophies.fetch(t,s)}&trophy_id=${i.join()}`)})}addAchieved(e){return t(this,void 0,void 0,function*(){const{username:t,token:s}=this.client.authCredentials;return yield this.request(`${n.trophies.add(t,s,e)}`)})}removeAchieved(e){return t(this,void 0,void 0,function*(){const{username:t,token:s}=this.client.authCredentials;return yield this.request(`${n.trophies.remove(t,s,e)}`)})}}class m extends h{fetch(e,s){return t(this,void 0,void 0,function*(){const{username:t,token:i}=this.client.authCredentials;let r=n.dataStorage.fetch(e);return s&&(r+=`&username=${t}&user_token=${i}`),yield this.request(r)})}set(e,s,i){return t(this,void 0,void 0,function*(){const{username:t,token:r}=this.client.authCredentials;let o=n.dataStorage.set(e,s);return i&&(o+=`&username=${t}&user_token=${r}`),yield this.request(o)})}update(e,s,i,r){return t(this,void 0,void 0,function*(){const{username:t,token:o}=this.client.authCredentials;let u=n.dataStorage.update(e,i,s);return r&&(u+=`&username=${t}&user_token=${o}`),yield this.request(u)})}remove(e,s){return t(this,void 0,void 0,function*(){const{username:t,token:i}=this.client.authCredentials;let r=n.dataStorage.remove(e);return s&&(r+=`&username=${t}&user_token=${i}`),yield this.request(r)})}getKeys(e,s){return t(this,void 0,void 0,function*(){const{username:t,token:i}=this.client.authCredentials;let r=n.dataStorage.getKeys();return e&&(r+=`&username=${t}&user_token=${i}`),s&&(r+=`&pattern=${s}`),yield this.request(r)})}}class p extends h{fetch(){return t(this,void 0,void 0,function*(){const{username:e,token:t}=this.client.authCredentials;return yield this.request(n.friends.fetch(e,t))})}}class $ extends h{fetch(){return t(this,void 0,void 0,function*(){return yield this.request(n.time.fetch())})}}var y;return(y=e.DataStoreOperations||(e.DataStoreOperations={})).Add="add",y.Subtract="subtract",y.Multiply="multiply",y.Divide="divide",y.Append="append",y.Prepend="prepend",e.GameJolt=class{constructor(e){this.gameId=e.gameId,this.privateKey=e.privateKey,this.authCredentials=e.authCredentials||{username:"",token:""},this.users=new c(this),this.sessions=new l(this),this.scores=new v(this),this.trophies=new f(this),this.dataStorage=new m(this),this.friends=new p(this),this.time=new $(this),e.authCredentials&&this.sessions.open()}login(e){return t(this,void 0,void 0,function*(){const t=yield this.users.auth(e);return t.success&&(this.authCredentials=e,this.sessions.open()),t})}logout(){return t(this,void 0,void 0,function*(){const e=yield this.sessions.close();return e.success&&(this.authCredentials={username:"",token:""}),e})}},e}({});